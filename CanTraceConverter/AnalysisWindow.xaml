<Window
  x:Class="CanTraceConverter.AnalysisWindow"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  Title="CAN Trace Analysis"
  Width="1400"
  Height="900"
  MinWidth="1200"
  MinHeight="700"
  Background="#F5F5F5"
  FontFamily="Segoe UI"
  FontSize="14"
  WindowStartupLocation="CenterScreen"
  WindowState="Maximized"
  mc:Ignorable="d">
  <Window.Resources>
    <!--  Modern Button Style  -->
    <Style x:Key="ModernButton" TargetType="Button">
      <Setter Property="Background" Value="#0078D4" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="Padding" Value="16,8" />
      <Setter Property="FontWeight" Value="SemiBold" />
      <Setter Property="Cursor" Value="Hand" />
      <Setter Property="Height" Value="30" />
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="Button">
            <Border
              Background="{TemplateBinding Background}"
              BorderBrush="{TemplateBinding BorderBrush}"
              BorderThickness="{TemplateBinding BorderThickness}"
              CornerRadius="4">
              <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
            </Border>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
      <Style.Triggers>
        <Trigger Property="IsMouseOver" Value="True">
          <Setter Property="Background" Value="#005A9E" />
        </Trigger>
        <Trigger Property="IsEnabled" Value="False">
          <Setter Property="Background" Value="#CCCCCC" />
          <Setter Property="Foreground" Value="#666666" />
        </Trigger>
      </Style.Triggers>
    </Style>

    <!--  Secondary Button Style  -->
    <Style x:Key="SecondaryButton" TargetType="Button">
      <Setter Property="Background" Value="White" />
      <Setter Property="Foreground" Value="#333333" />
      <Setter Property="BorderBrush" Value="#CCCCCC" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="Padding" Value="12,6" />
      <Setter Property="FontWeight" Value="Normal" />
      <Setter Property="Cursor" Value="Hand" />
      <Setter Property="Height" Value="30" />

      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="Button">
            <Border
              Background="{TemplateBinding Background}"
              BorderBrush="{TemplateBinding BorderBrush}"
              BorderThickness="{TemplateBinding BorderThickness}"
              CornerRadius="4">
              <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
            </Border>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
      <Style.Triggers>
        <Trigger Property="IsMouseOver" Value="True">
          <Setter Property="Background" Value="#F0F0F0" />
          <Setter Property="BorderBrush" Value="#999999" />
        </Trigger>
      </Style.Triggers>
    </Style>

    <!--  Modern TextBox Style  -->
    <Style x:Key="ModernTextBox" TargetType="TextBox">
      <Setter Property="Padding" Value="8,6" />
      <Setter Property="BorderBrush" Value="#CCCCCC" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="Background" Value="White" />
      <Setter Property="VerticalContentAlignment" Value="Center" />

      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="TextBox">
            <Border
              Background="{TemplateBinding Background}"
              BorderBrush="{TemplateBinding BorderBrush}"
              BorderThickness="{TemplateBinding BorderThickness}"
              CornerRadius="4">
              <ScrollViewer x:Name="PART_ContentHost" />
            </Border>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
      <Style.Triggers>
        <Trigger Property="IsFocused" Value="True">
          <Setter Property="BorderBrush" Value="#0078D4" />
          <Setter Property="BorderThickness" Value="2" />
        </Trigger>
      </Style.Triggers>
    </Style>

    <!--  ComboBox Style  -->
    <Style x:Key="ModernComboBox" TargetType="ComboBox">
      <Setter Property="Padding" Value="8,6" />
      <Setter Property="BorderBrush" Value="#CCCCCC" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="Background" Value="White" />
    </Style>

    <!--  DataGrid Style  -->
    <Style x:Key="ModernDataGrid" TargetType="DataGrid">
      <Setter Property="Background" Value="White" />
      <Setter Property="BorderBrush" Value="#E0E0E0" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="RowBackground" Value="White" />
      <Setter Property="AlternatingRowBackground" Value="#F9F9F9" />
      <Setter Property="GridLinesVisibility" Value="Horizontal" />
      <Setter Property="HorizontalGridLinesBrush" Value="#E0E0E0" />
      <Setter Property="AutoGenerateColumns" Value="False" />
      <Setter Property="CanUserAddRows" Value="False" />
      <Setter Property="CanUserDeleteRows" Value="False" />
      <Setter Property="IsReadOnly" Value="True" />
      <Setter Property="SelectionMode" Value="Extended" />
      <Setter Property="SelectionUnit" Value="FullRow" />
      <Setter Property="FontFamily" Value="Consolas" />
      <Setter Property="FontSize" Value="12" />
    </Style>
  </Window.Resources>

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!--  Header  -->
    <Border
      Grid.Row="0"
      Padding="24,20"
      Background="White"
      BorderBrush="#E0E0E0"
      BorderThickness="0,0,0,1">
      <Grid>
        <StackPanel VerticalAlignment="Center">
          <TextBlock
            FontSize="20"
            FontWeight="SemiBold"
            Foreground="#333333"
            Text="CAN Trace Analysis" />
          <TextBlock
            Margin="0,4,0,0"
            FontSize="13"
            Foreground="#666666"
            Text="Advanced filtering and analysis of CAN messages" />
        </StackPanel>
      </Grid>
    </Border>

    <!--  Main Content  -->
    <Grid Grid.Row="1" Margin="24,20,24,0">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="350" />
        <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>

      <!--  Left Panel: Filters and Statistics  -->
      <Border
        Grid.Column="0"
        Margin="0,0,12,0"
        Background="White"
        BorderBrush="#E0E0E0"
        BorderThickness="1"
        CornerRadius="6">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
          <StackPanel Margin="16">


            <!--  Filter Section  -->
            <TextBlock
              Margin="0,0,0,8"
              FontSize="15"
              FontWeight="SemiBold"
              Foreground="#333333"
              Text="Filters" />

            <!--  Direction Filter  -->
            <TextBlock
              Margin="0,8,0,4"
              FontWeight="Medium"
              Foreground="#555555"
              Text="Direction:" />
            <ComboBox
              x:Name="cmbDirection"
              SelectionChanged="OnFilterChanged"
              Style="{StaticResource ModernComboBox}">
              <ComboBoxItem Content="All" IsSelected="True" />
              <ComboBoxItem Content="RX" />
              <ComboBoxItem Content="TX" />
            </ComboBox>

            <!--  CAN ID Filter  -->
            <TextBlock
              Margin="0,12,0,4"
              FontWeight="Medium"
              Foreground="#555555"
              Text="CAN ID (hex):" />
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>
              <TextBox
                x:Name="txtCanIdFilter"
                Grid.Column="0"
                Style="{StaticResource ModernTextBox}"
                TextChanged="OnFilterChanged"
                ToolTip="Enter CAN ID in hex (e.g., 0B060602)" />
              <Button
                x:Name="btnClearCanId"
                Grid.Column="1"
                Margin="4,0,0,0"
                Padding="8,6"
                Click="btnClearCanId_Click"
                Content="âœ•"
                Style="{StaticResource SecondaryButton}" />
            </Grid>

            <!--  DLC Filter  -->
            <TextBlock
              Margin="0,12,0,4"
              FontWeight="Medium"
              Foreground="#555555"
              Text="DLC (Data Length):" />
            <ComboBox
              x:Name="cmbDlcFilter"
              SelectionChanged="OnFilterChanged"
              Style="{StaticResource ModernComboBox}">
              <ComboBoxItem Content="All" IsSelected="True" />
              <ComboBoxItem Content="0" />
              <ComboBoxItem Content="1" />
              <ComboBoxItem Content="2" />
              <ComboBoxItem Content="3" />
              <ComboBoxItem Content="4" />
              <ComboBoxItem Content="5" />
              <ComboBoxItem Content="6" />
              <ComboBoxItem Content="7" />
              <ComboBoxItem Content="8" />
            </ComboBox>

            <!--  Time Range Filter  -->
            <TextBlock
              Margin="0,12,0,4"
              FontWeight="Medium"
              Foreground="#555555"
              Text="Time Range (msec):" />
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
              </Grid.ColumnDefinitions>
              <TextBox
                x:Name="txtTimeFrom"
                Grid.Column="0"
                Style="{StaticResource ModernTextBox}"
                TextChanged="OnFilterChanged"
                ToolTip="From (msec)" />
              <TextBlock
                Grid.Column="1"
                Margin="8,0"
                VerticalAlignment="Center"
                Text="to" />
              <TextBox
                x:Name="txtTimeTo"
                Grid.Column="2"
                Style="{StaticResource ModernTextBox}"
                TextChanged="OnFilterChanged"
                ToolTip="To (msec)" />
            </Grid>

            <!--  Data Pattern Filter  -->
            <TextBlock
              Margin="0,12,0,4"
              FontWeight="Medium"
              Foreground="#555555"
              Text="Data Pattern (hex):" />
            <TextBox
              x:Name="txtDataPattern"
              Style="{StaticResource ModernTextBox}"
              TextChanged="OnFilterChanged"
              ToolTip="Search for hex pattern in data (e.g., 21 06)" />

            <!--  Source/Node ID Filter  -->
            <TextBlock
              Margin="0,12,0,4"
              FontWeight="Medium"
              Foreground="#555555"
              Text="Source/Node ID (from CAN ID):" />
            <TextBox
              x:Name="txtSourceIdFilter"
              Style="{StaticResource ModernTextBox}"
              TextChanged="OnFilterChanged"
              ToolTip="Filter by source/node ID extracted from CAN ID" />

            <!--  Function Code Filter  -->
            <TextBlock
              Margin="0,12,0,4"
              FontWeight="Medium"
              Foreground="#555555"
              Text="Function Code (from data byte):" />
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
              </Grid.ColumnDefinitions>
              <TextBlock
                Grid.Column="0"
                Margin="0,0,8,0"
                VerticalAlignment="Center"
                Text="Byte:" />
              <ComboBox
                x:Name="cmbFunctionCodeByte"
                Grid.Column="1"
                Margin="0,0,8,0"
                SelectionChanged="OnFilterChanged"
                Style="{StaticResource ModernComboBox}">
                <ComboBoxItem Content="0" IsSelected="True" />
                <ComboBoxItem Content="1" />
                <ComboBoxItem Content="2" />
                <ComboBoxItem Content="3" />
                <ComboBoxItem Content="4" />
                <ComboBoxItem Content="5" />
                <ComboBoxItem Content="6" />
                <ComboBoxItem Content="7" />
              </ComboBox>
              <TextBox
                x:Name="txtFunctionCode"
                Grid.Column="2"
                Style="{StaticResource ModernTextBox}"
                TextChanged="OnFilterChanged"
                ToolTip="Value (hex)" />
            </Grid>

            <!--  Action Buttons  -->
            <StackPanel Margin="0,20,0,0" Orientation="Vertical">
              <Button
                Click="btnApplyFilters_Click"
                Content="Apply Filters"
                Style="{StaticResource ModernButton}" />
              <Button
                Margin="0,8,0,0"
                Click="btnClearFilters_Click"
                Content="Clear All Filters"
                Style="{StaticResource SecondaryButton}" />
              <Button
                Margin="0,8,0,0"
                Click="btnExportFiltered_Click"
                Content="Export Filtered Data"
                Style="{StaticResource SecondaryButton}" />
            </StackPanel>

            <!--  Statistics Section  -->
            <TextBlock
              Margin="0,24,0,8"
              FontSize="15"
              FontWeight="SemiBold"
              Foreground="#333333"
              Text="Statistics" />
            <Border
              Padding="12"
              Background="#F9F9F9"
              BorderBrush="#E0E0E0"
              BorderThickness="1"
              CornerRadius="4">
              <StackPanel>
                <TextBlock
                  x:Name="txtStatistics"
                  FontFamily="Consolas"
                  FontSize="11"
                  Foreground="#666666" />
              </StackPanel>
            </Border>

            <!--  Unique CAN IDs  -->
            <TextBlock
              Margin="0,16,0,8"
              FontWeight="Medium"
              Foreground="#555555"
              Text="Unique CAN IDs:" />
            <ListBox
              x:Name="lstUniqueIds"
              Height="150"
              BorderBrush="#E0E0E0"
              BorderThickness="1"
              FontFamily="Consolas"
              FontSize="11"
              SelectionChanged="lstUniqueIds_SelectionChanged" />

            <!--  File Information  -->
            <TextBlock
              Margin="0,0,0,8"
              FontSize="15"
              FontWeight="SemiBold"
              Foreground="#333333"
              Text="File Information" />
            <Border
              Padding="12"
              Background="#F9F9F9"
              BorderBrush="#E0E0E0"
              BorderThickness="1"
              CornerRadius="4">
              <StackPanel>
                <TextBlock
                  x:Name="txtFileInfo"
                  FontFamily="Consolas"
                  FontSize="11"
                  Foreground="#666666"
                  TextWrapping="Wrap" />
              </StackPanel>
            </Border>
          </StackPanel>
        </ScrollViewer>
      </Border>

      <!--  Right Panel: Data Grid  -->
      <Border
        Grid.Column="1"
        Background="White"
        BorderBrush="#E0E0E0"
        BorderThickness="1"
        CornerRadius="6">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>

          <!--  Toolbar  -->
          <Border
            Grid.Row="0"
            Padding="16,12"
            Background="#FAFAFA"
            BorderBrush="#E0E0E0"
            BorderThickness="0,0,0,1">
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>

              <TextBlock
                Grid.Column="0"
                VerticalAlignment="Center"
                FontWeight="SemiBold"
                Foreground="#333333"
                Text="CAN Messages" />

              <StackPanel
                Grid.Column="2"
                HorizontalAlignment="Right"
                Orientation="Horizontal">
                <TextBlock
                  Margin="0,0,8,0"
                  VerticalAlignment="Center"
                  Foreground="#666666"
                  Text="View Mode:" />
                <ComboBox
                  x:Name="cmbViewMode"
                  Width="180"
                  SelectionChanged="cmbViewMode_SelectionChanged"
                  Style="{StaticResource ModernComboBox}">
                  <ComboBoxItem Content="All Messages" IsSelected="True" />
                  <ComboBoxItem Content="Unique CAN IDs Only" />
                  <ComboBoxItem Content="Message Timeline" />
                  <ComboBoxItem Content="Frequency Analysis" />
                </ComboBox>
              </StackPanel>
            </Grid>
          </Border>

          <!--  Data Grid  -->
          <DataGrid
            x:Name="dgMessages"
            Grid.Row="1"
            FontSize="16"
            Style="{StaticResource ModernDataGrid}">
            <DataGrid.Columns>
              <DataGridTextColumn
                Width="60"
                Binding="{Binding Direction}"
                Header="DIR" />
              <DataGridTextColumn
                Width="100"
                Binding="{Binding Time}"
                Header="TIME (msec)" />
              <DataGridTextColumn
                Width="110"
                Binding="{Binding CanId}"
                Header="CAN ID" />
              <DataGridTextColumn
                Width="50"
                Binding="{Binding Dlc}"
                Header="DLC" />
              <DataGridTextColumn
                Width="*"
                Binding="{Binding Data}"
                Header="DATA" />
            </DataGrid.Columns>
          </DataGrid>

          <!--  Message Count  -->
          <Border
            Grid.Row="2"
            Padding="16,8"
            Background="#FAFAFA"
            BorderBrush="#E0E0E0"
            BorderThickness="0,1,0,0">
            <TextBlock
              x:Name="txtMessageCount"
              FontSize="12"
              Foreground="#666666"
              Text="0 messages displayed" />
          </Border>
        </Grid>
      </Border>
    </Grid>

    <!--  Footer  -->
    <Border
      Grid.Row="2"
      Padding="24,16"
      Background="White"
      BorderBrush="#E0E0E0"
      BorderThickness="0,1,0,0">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <TextBlock
          x:Name="txtStatus"
          Grid.Column="0"
          VerticalAlignment="Center"
          FontSize="13"
          Foreground="#666666"
          Text="Analysis ready" />

        <Button
          Grid.Column="1"
          Width="100"
          Click="btnClose_Click"
          Content="Close"
          Style="{StaticResource SecondaryButton}" />
      </Grid>
    </Border>
  </Grid>
</Window>
